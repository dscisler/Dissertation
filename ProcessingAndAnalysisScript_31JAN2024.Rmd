---
title: "ProcessingAndAnalysisScript_JAN2024"
author: "Dean Cisler"
date: "`r Sys.Date()`"
output:
  word_document: 
    toc: true
  html_document: default
  pdf_document: default
---

 

```{r}
#Libraries
library(readr)
library(readxl)
library(dplyr)
library(tidyr)
library(rstatix) #need to update to the latest version of r
library(psycho)
library(ggplot2)
library(hrbrthemes)
library(PerformanceAnalytics)
library(tools)
library(stringr)
library(factoextra)
library(digest)

#Creating the raw dataset

#Get the list of filenames and their paths
datalist = list()
file_names_listed_EXP1EnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1Enjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names_listed_EXP1NotEnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1NotEnjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names_listed_EXP2EnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2Enjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names_listed_EXP2NotEnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2NotEnjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names_listed_EXP3EnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/SART/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names_listed_EXP3NotEnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/SART/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names_listed_EXP3TSEnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/TS/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names_listed_EXP3TSNotEnjoyRaw <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/TS/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

file_names <- c(file_names_listed_EXP1EnjoyRaw, file_names_listed_EXP1NotEnjoyRaw, file_names_listed_EXP2EnjoyRaw, file_names_listed_EXP2NotEnjoyRaw, file_names_listed_EXP3EnjoyRaw, file_names_listed_EXP3NotEnjoyRaw, file_names_listed_EXP3TSEnjoyRaw, file_names_listed_EXP3TSNotEnjoyRaw)

#Load Each List Into Its Own Dataframe the Merge Them All Together
path1 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1Enjoy/Raw/"
path2 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1NotEnjoy/Raw/"
path3 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2Enjoy/Raw/"
path4 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2NotEnjoy/Raw/"
path5 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/SART/Raw/"
path6 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/SART/Raw/"
path7 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/TS/Raw/"
path8 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/TS/Raw/"

folder_paths <- c(path1, path2, path3, path4, path5, path6, path7, path8)

# Create an empty list to store dataframes
dataframes_list <- list()

# Loop through the folder paths and load each file into a dataframe
tryCatch({
for (folder_path in folder_paths) {
  
  files_in_folder <- list.files(path = folder_path, full.names = TRUE)

  # Iterate through each file in the folder
    for (file_path in files_in_folder) {
      # Read the file using the full path with read_csv
      data <- read.table(file_path,
                     sep='\t', header=TRUE, stringsAsFactors = FALSE)
      
      # Extract the file name without extension
      file_name <- tools::file_path_sans_ext(basename(file_path))
      
      # Update the dataframe name using the file name
      dataframe_name <- paste0("df_", file_name)
  
  # Assign the dataframe to the list
  dataframes_list[[dataframe_name]] <- data
  }
}
}, error = function(e) {
  cat("An error occurred:", conditionMessage(e), "\n")
})

RawDataSet <- bind_rows(dataframes_list, .id = "source")

#Again but with the survey data
#Load Each List Into Its Own Dataframe the Merge Them All Together
path1 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1Enjoy/Survey/"
path2 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1NotEnjoy/Survey/"
path3 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2Enjoy/Survey/"
path4 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2NotEnjoy/Survey/"
path5 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/SART/Survey/"
path6 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/SART/Survey/"
path7 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/TS/Survey/"
path8 = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/TS/Survey/"

folder_paths_survey <- c(path1, path2, path3, path4, path5, path6, path7, path8)

# Create an empty list to store dataframes
dataframes_list_survey <- list()

# Loop through the folder paths and load each file into a dataframe
tryCatch({
for (folder_path in folder_paths_survey) {
  
  files_in_folder <- list.files(path = folder_paths_survey, full.names = TRUE)

  # Iterate through each file in the folder
    for (file_path in files_in_folder) {
      # Read the file using the full path with read_csv
      data <- read.table(file_path,
                     sep='\t', header=TRUE, stringsAsFactors = FALSE)
      
      # Extract the file name without extension
      file_name <- tools::file_path_sans_ext(basename(file_path))
      
      # Update the dataframe name using the file name
      dataframe_name <- paste0("df_", file_name)
  
  # Assign the dataframe to the list
  dataframes_list_survey[[dataframe_name]] <- data
  }
}
}, error = function(e) {
  cat("An error occurred:", conditionMessage(e), "\n")
})

SurveyDataSet <- bind_rows(dataframes_list_survey, .id = "source")

CompleteDataSet <- left_join(RawDataSet, SurveyDataSet, by = 'subject')



# Function to create MD5 checksum for a dataframe
create_checksum <- function(dataframe) {
  # Convert dataframe to a character string
  dataframe_str <- as.character(dataframe)
  
  # Create MD5 checksum using digest function
  md5_checksum <- digest(dataframe_str, algo = "md5", serialize = FALSE)
  
  return(md5_checksum)
}

# Create MD5 checksum for the example dataframe
#MindWanderingDissertation <- create_checksum(CompleteDataSet)

# Print the checksum
#print(MindWanderingDissertation)

#write.csv(CompleteDataSet, "C:/Users/Cisler/Desktop/Data/For Analysis/CompleteDataSet.csv")


###Add in Exp Number and Condition
list1 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1Enjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list2 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp1NotEnjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list3 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2Enjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list4 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp2NotEnjoy/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list5 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/SART/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list6 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/SART/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list7 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3Enjoy/TS/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list8 <- list.files(path = "C:/Users/Cisler/Desktop/Data/For Analysis/Exp3NotEnjoy/TS/Raw", full.names = FALSE,
                                             pattern = "*.iqdat")

list1 <- sub("\\.iqdat$", "", list1)
list2 <- sub("\\.iqdat$", "", list2)
list3 <- sub("\\.iqdat$", "", list3)
list4 <- sub("\\.iqdat$", "", list4)
list5 <- sub("\\.iqdat$", "", list5)
list6 <- sub("\\.iqdat$", "", list6)
list7 <- sub("\\.iqdat$", "", list7)
list8 <- sub("\\.iqdat$", "", list8)

CompleteDataSet$source.x <- gsub("^df_", "", CompleteDataSet$source.x)
df <- CompleteDataSet

# Create conditions for each list
condition1 <- df$source.x %in% list1
condition2 <- df$source.x %in% list2
condition3 <- df$source.x %in% list3
condition4 <- df$source.x %in% list4
condition5 <- df$source.x %in% list5
condition6 <- df$source.x %in% list6
condition7 <- df$source.x %in% list7
condition8 <- df$source.x %in% list8

# Repeat for list3, list4, ..., list8

# Apply conditions iteratively
df <- df %>%
  mutate(
    new_exp_column = case_when(
      condition1 ~ "EXP1",
      condition2 ~ "EXP1",
      condition3 ~ "EXP2",
      condition4 ~ "EXP2",
      condition5 ~ "EXP3-SART",
      condition6 ~ "EXP3-SART",
      condition7 ~ "EXP3-TS",
      condition8 ~ "EXP3-TS",
      # Add more conditions for other lists if needed
      TRUE ~ NA_character_
    ),
    new_cond_column = case_when(
      condition1 ~ "Enjoy",
      condition2 ~ "NotEnjoy",
      condition3 ~ "Enjoy",
      condition4 ~ "NotEnjoy",
      condition5 ~ "Enjoy",
      condition6 ~ "NotEnjoy",
      condition7 ~ "Enjoy",
      condition8 ~ "NotEnjoy",
      # Add more conditions for other lists if needed
      TRUE ~ NA_character_
    )
  )

# Remove temporary conditions
rm(condition1, condition2, condition3, condition4, condition5, condition6, condition7, condition8)




```


```{r}
#Analyses
library(RColorBrewer)
library(ISLR)
library(tidyverse)
library(Rfast)
library(MASS)
library(ggpubr)
library(vcd)
library(ggmosaic)
library(gridExtra)
library(lme4)
library(lmerTest)
source('https://github.com/pablobernabeu/language-sensorimotor-simulation-PhD-thesis/raw/main/R_functions/frequentist_model_table.R')

#Separate Out EXP1 and EXP2 into different dataframes
EXP1df <- df %>% filter(grepl("^EXP1", new_exp_column, ignore.case = TRUE))

EXP1MWcatch <- df %>% filter(grepl("MWcatch", trialcode, ignore.case = TRUE))
EXP1MWcatch$response <- as.numeric(EXP1MWcatch$response)
EXP1MWcatchaverages <- aggregate(response ~ subject, EXP1MWcatch, mean)
EXP1MWcatchaverages <- EXP1MWcatchaverages %>%
  rename(MWcatch_response = response)

EXP1MWonTask <- df %>% filter(grepl("MWonTask", trialcode, ignore.case = TRUE))
EXP1MWonTask$response <- as.numeric(EXP1MWonTask$response)
EXP1MWonTaskaverages <- aggregate(response ~ subject, EXP1MWonTask, mean)
EXP1MWonTaskaverages <- EXP1MWonTaskaverages %>%
  rename(MWonTask_response = response)

EXP1MWother <- df %>% filter(grepl("MWother", trialcode, ignore.case = TRUE))
EXP1MWother$response <- as.numeric(EXP1MWother$response)
EXP1MWotheraverages <- aggregate(response ~ subject, EXP1MWother, mean)
EXP1MWotheraverages <- EXP1MWotheraverages %>%
  rename(MWother_response = response)

EXP1MWcatchTrialsAverages <- merge(merge(EXP1MWcatchaverages, EXP1MWonTaskaverages, by = "subject"), EXP1MWotheraverages, by = "subject")

EXP2df <- df %>% filter(grepl("^EXP2", new_exp_column, ignore.case = TRUE))

#Filters code for probe responses only
EXP1df <- EXP1df %>% filter(grepl('probe', trialcode))

#Filter to exclude probe2 responses
EXP1df <- EXP1df %>% filter(!grepl('probe2', trialcode))
#ProbeRespons$filt <- ProbeRespons$filt %>% replace_na('filter1')

EXP1probe <- EXP1df %>% dplyr::select(subject, new_exp_column, new_cond_column, response, paid_response)
EXP1probe <- EXP1probe %>% rename(probe_response = response)

EXP2probe <- EXP2df %>% dplyr::select(subject, new_exp_column, new_cond_column, probe_response, paid_response)
EXP2probe <- EXP2probe[!duplicated(EXP2probe$subject), ]

ProbeRespons <- rbind(EXP1probe, EXP2probe)


#
PersonProbeCount <- ProbeRespons %>% group_by(subject, new_exp_column, new_cond_column) %>% count(probe_response)


exp1tab <- ProbeRespons %>% filter(new_exp_column == 'EXP1')
exp2tab <- ProbeRespons %>% filter(new_exp_column == 'EXP2')
con3 <- xtabs( ~ new_cond_column+probe_response, data = exp1tab)
con3

Exp1prop <- prop.table(con3, margin = 1)
Exp1prop
mosaicplot(Exp1prop)

title <- "Proportion of Responses to the Mind Wandering Probes\nAdministered During the Task by Enjoyment Condition"

intProbe <- ggplot(data = EXP1probe)+
geom_mosaic(aes(x = product(probe_response, new_cond_column), fill=new_cond_column), na.rm=TRUE) +
  labs(
    x = "Enjoyment Condition",
    y = "Responses to Mind Wandering Probe") +
    ggtitle(title
  )
intProbe

con4 <- xtabs( ~ new_cond_column+probe_response, data = exp2tab)
con4
Exp2prop <- prop.table(con4, margin = 1)
Exp2prop
mosaicplot(Exp2prop)

title <- "Proportion of Responses to the Mind Wandering Probes\nAdministered Post Task by Enjoyment Condition"

postProbe <- ggplot(data = EXP2probe)+
geom_mosaic(aes(x = product(probe_response, new_cond_column), fill=new_cond_column), na.rm=TRUE) +
  labs(
    x = "Enjoyment Condition",
    y = "Responses to Mind Wandering Probe") +
    ggtitle(title)
postProbe

bothPlots <- grid.arrange(intProbe, postProbe, ncol = 2)
ggsave("arranged_plots.png", bothPlots, width = 12, height = 6, units = "in", dpi = 300)

grid.arrange(intProbe, postProbe, ncol = 2)

###########################################################################################
#End Creating Mosaic Plots
###########################################################################################

###########################################################################################
#Creating Tables and Plots on re-engagement with the task; Analysis of SART Data
###########################################################################################
# Create a function to process each subject
process_subject <- function(subject_data) {
  # Count the number of "Yes" and "No" responses
  yes_count <- sum(subject_data$probe_response == "Yes")
  no_count <- sum(subject_data$probe_response == "No")
  
  # Compare counts and assign a value based on the majority response
  if (yes_count > no_count) {
    result <- "Yes"
  } else if (yes_count < no_count) {
    result <- "No"
  } else {
    result <- "Tie"  # Handle tie situations if needed
  }
  
  return(result)
}

# Iterate through subjects and process each one
results <- sapply(split(ProbeRespons, ProbeRespons$subject), process_subject)

# Display the results
MWresult_dataExp1Exp2 <- data.frame(subject = names(results), MWer = results)
print(MWresult_dataExp1Exp2)
MWresult_dataExp1Exp2$subject <- as.integer(MWresult_dataExp1Exp2$subject)



MWassign <- left_join(ProbeRespons, MWresult_dataExp1Exp2, by = 'subject')

Exp1EnjoyAnalysis <- MWassign %>% filter(new_exp_column == 'EXP1')
Exp1EnjoyAnalysis <- Exp1EnjoyAnalysis %>% filter(new_cond_column == 'Enjoy')
#Exp1EnjoyAnalysis <- Exp1EnjoyAnalysis %>% filter(filt == 'filter1')
Exp1EnjoyAnalysis <- Exp1EnjoyAnalysis %>% distinct(subject, .keep_all = TRUE)

Exp1NotEnjoyAnalysis <- MWassign %>% filter(new_exp_column == 'EXP1')
Exp1NotEnjoyAnalysis <- Exp1NotEnjoyAnalysis %>% filter(new_cond_column == 'NotEnjoy')
#Exp1NotEnjoyAnalysis <- Exp1NotEnjoyAnalysis %>% filter(filt == 'filter1')
Exp1NotEnjoyAnalysis <- Exp1NotEnjoyAnalysis %>% distinct(subject, .keep_all = TRUE)

Exp2EnjoyAnalysis <- MWassign %>% filter(new_exp_column == 'EXP2')
Exp2EnjoyAnalysis <- Exp2EnjoyAnalysis %>% filter(new_cond_column == 'Enjoy')
#Exp2EnjoyAnalysis <- Exp2EnjoyAnalysis %>% filter(filt == 'filter1')
Exp2EnjoyAnalysis <- Exp2EnjoyAnalysis %>% distinct(subject, .keep_all = TRUE)

Exp2NotEnjoyAnalysis <- MWassign %>% filter(new_exp_column == 'EXP2')
Exp2NotEnjoyAnalysis <- Exp2NotEnjoyAnalysis %>% filter(new_cond_column == 'NotEnjoy')
#Exp2NotEnjoyAnalysis <- Exp2NotEnjoyAnalysis %>% filter(filt == 'filter1')
Exp2NotEnjoyAnalysis <- Exp2NotEnjoyAnalysis %>% distinct(subject, .keep_all = TRUE)

exp1exp2Analysis <- rbind(Exp1EnjoyAnalysis, Exp2EnjoyAnalysis, Exp1NotEnjoyAnalysis, Exp2NotEnjoyAnalysis)

exp1exp2Analysis2 <- exp1exp2Analysis
exp1exp2Analysis2$new_exp_column <- as.factor(exp1exp2Analysis2$new_exp_column)
exp1exp2Analysis2$new_cond_column <- as.factor(exp1exp2Analysis2$new_cond_column)
exp1exp2Analysis2$MWer <- as.factor(exp1exp2Analysis2$MWer)

# exp1Analysis <- exp1exp2Analysis2
# exp1Analysis <- exp1Analysis %>% filter(new_exp_colum == 'exp1')
# 
# exp2Analysis <- exp1exp2Analysis2
# exp2Analysis <- exp2Analysis %>% filter(new_exp_colum == 'exp2')



# write.csv(exp1exp2Analysis2, "C:/Users/Cisler/Desktop/Data/For Analysis/ProbeAnalysisForRQs1and2.csv")
# write.csv(df, "C:/Users/Cisler/Desktop/Data/For Analysis/CompleteDatasetWithTransformationsAndModifications_17JAN2024.csv")

```
```{r}
####Analysis of SART Performance
SARTexp1 <- df %>% filter(new_exp_column == "EXP1")

SARTexp1 <- SARTexp1 %>% filter(blockcode == "SART")
SARTexp1 <- SARTexp1 %>% filter(trialcode != "probe")
SARTexp1 <- SARTexp1 %>% filter(trialcode != "probe2")
SARTexp1 <- SARTexp1 %>% filter(trialcode != "MWcatch")
SARTexp1 <- SARTexp1 %>% filter(trialcode != "MWonTask")
SARTexp1 <- SARTexp1 %>% filter(trialcode != "MWother")

SARTexp2 <- df %>% filter(new_exp_column == "EXP2")
SARTexp2 <- SARTexp2 %>% filter(blockcode == "SART")

SARTexp1exp2 <- rbind(SARTexp1, SARTexp2)
SARTexp1exp2 <- left_join(SARTexp1exp2, MWresult_dataExp1Exp2, by = "subject")

SARTexp1exp2 <- SARTexp1exp2 %>% filter(MWer != "Tie")

#NASA-TLX Transformations
SARTexp1exp2 <- SARTexp1exp2 %>%
  mutate(mentaldemand_response_coded = (mentaldemand_response - 1) * 5)


SARTexp1exp2 <- SARTexp1exp2 %>%
  mutate(physicaldemand_response_coded = (physicaldemand_response - 1) * 5)


SARTexp1exp2 <- SARTexp1exp2 %>%
  mutate(temporaldemand_response_coded = (temporaldemand_response - 1) * 5)


SARTexp1exp2 <- SARTexp1exp2 %>%
  mutate(performance_response_coded = (performance_response - 1) * 5)


SARTexp1exp2 <- SARTexp1exp2 %>%
  mutate(effort_response_coded = (effort_response - 1) * 5)

SARTexp1exp2 <- SARTexp1exp2 %>%
  mutate(frustration_response_coded = (frustration_response - 1) * 5)


SARTexp1exp2$hit <- ifelse(SARTexp1exp2$trialtype == "NoGo" & SARTexp1exp2$correct == 1, 1, 0)
SARTexp1exp2$miss <- ifelse(SARTexp1exp2$trialtype == "NoGo" & SARTexp1exp2$correct == 0, 1, 0)
SARTexp1exp2$CR <- ifelse(SARTexp1exp2$trialtype == "Go" & SARTexp1exp2$correct == 1, 1, 0)
SARTexp1exp2$FA <- ifelse(SARTexp1exp2$trialtype == "Go" & SARTexp1exp2$correct == 0, 1, 0)


SARTrtFilt <- SARTexp1exp2 %>% filter(correct == 1)
SARTrtFilt <- SARTexp1exp2 %>% filter(trialtype == "Go")
SARTfaFilt <- SARTexp1exp2 %>% filter(trialtype == "Go")

SARTaccFilt <- SARTexp1exp2 %>% filter(trialtype == "NoGo")
SARTmissFilt <- SARTexp1exp2 %>% filter(trialtype == "NoGo")

FAmean <- aggregate(FA ~ subject + new_exp_column + new_cond_column, SARTfaFilt, mean)
Hitmean <- aggregate(correct ~ subject + new_exp_column + new_cond_column, SARTaccFilt, mean)
Missmean <- aggregate(CR ~ subject + new_exp_column + new_cond_column, SARTrtFilt, mean)
RTmean <- aggregate(latency ~ subject + new_exp_column + new_cond_column, SARTrtFilt, mean)

QualCheck <- left_join(Hitmean, FAmean, by = "subject") %>%
  left_join(Missmean, by = "subject") %>%
  left_join(RTmean, by = "subject")
QualCheckExp1 <- QualCheck %>% filter(new_exp_column.x == "EXP1")
#Subject 566606496 is an outlier.  It appears they just kept hitting the space bar.  This person should have been excluded.  For some reason, they made it through my exclusion checks
QualCheck2 <- SARTexp1exp2 %>% filter(subject == "566606496")

QualCheckExp2 <- QualCheck %>% filter(new_exp_column.x == "EXP2")
QualCheck2_2 <- SARTexp1exp2 %>% filter(subject == "197955474")
#Nothing is overtly odd about their data.  My only concern is that the datafile was recorded at 2:30 am.  They could be fatigued.

###Analysis of RT for SART
# RTlm <- lm(latency~new_exp_column*new_cond_column, data = SARTrtFilt)
# summary(RTlm)

RTlm <- lmer(latency~new_exp_column*new_cond_column + (1|subject), data = SARTrtFilt)
RTlmConfInt <- confint(RTlm)
RTLMERresults <- summary(RTlm)
frequentist_model_table(RTLMERresults, RTlmConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "Latency by Probe Placement and Enjoyment Condition")



RTbyGroup <- ggplot(SARTrtFilt, aes(x = new_cond_column, y = latency, fill = new_exp_column)) +
    stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 2)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average Reaction Time",
    title = "Average Reaction Time Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
RTbyGroup


RTbyConditionsInt <- SARTrtFilt %>%
  group_by(new_exp_column, new_cond_column) %>%
  summarize(mean_value = mean(paid_response))


#####Analysis of ACC for SART NoGo Trials
# ACClm <- lm(correct ~ new_exp_column*new_cond_column, data = SARTaccFilt)
# summary(ACClm)

ACClm <- lmer(correct ~ new_exp_column*new_cond_column + (1|subject), data = SARTaccFilt)
ACClmConfInt <- confint(ACClm)
ACCLMERresults <- summary(ACClm)
frequentist_model_table(ACCLMERresults, ACClmConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "Accuracy to No Go Trials by Probe Placement and Enjoyment Condition")

ACCbyGroup <- ggplot(SARTaccFilt, aes(x = new_cond_column, y = correct, fill = new_exp_column)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 2)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average Reaction Time",
    title = "Average Accuracy of No Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
ACCbyGroup

SARTfaFilt <- SARTrtFilt
SARTmissFILT <- SARTaccFilt

#Remember*** I am interpreting the target (No Go trials) as hits.  So withholding a response on a Go trial would be an FA
# FAlm <- lm(FA ~ new_exp_column*new_cond_column, data = SARTfaFilt)
# summary(FAlm)

FAlm <- lmer(FA ~ new_exp_column*new_cond_column + (1|subject), data = SARTfaFilt)
FAlmConfInt <- confint(FAlm)
FALMERresults <- summary(FAlm)
frequentist_model_table(FALMERresults, FAlmConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "False Alarms by Probe Placement and Enjoyment Condition")





FAbyGroup <- ggplot(SARTfaFilt, aes(x = new_cond_column, y = FA, fill = new_exp_column)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average False Alarms",
    title = "Average False Alarms of Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
FAbyGroup

FAbyConditionsInt <- SARTfaFilt %>%
  group_by(new_exp_column, new_cond_column) %>%
  summarize(mean_value = mean(FA))

FAbyConditionsInt

ggplot(SARTfaFilt, aes(x = FA, fill = new_cond_column)) +
  geom_density(alpha=0.2)


FAbySub <- SARTfaFilt %>% filter(new_exp_column == 'EXP1')

 
ggplot(FAbySub, aes(x = FA, fill = new_cond_column)) +
  geom_density(alpha=0.2)

FAbySub <- ggplot(SARTfaFilt, aes(x = subject, y = FA, fill = new_cond_column)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average False Alarms",
    title = "Average False Alarms of Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
FAbySub


MISSbyGroup <- ggplot(SARTaccFilt, aes(x = new_cond_column, y = miss, fill = new_exp_column)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average False Alarms",
    title = "Average False Alarms of Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
MISSbyGroup

MissbyConditionsInt <- SARTfaFilt %>%
  group_by(new_exp_column, new_cond_column) %>%
  summarize(mean_value = mean(miss))


CRbyGroup <- ggplot(SARTfaFilt, aes(x = new_cond_column, y = CR, fill = new_exp_column)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average False Alarms",
    title = "Average False Alarms of Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
CRbyGroup

CRbyConditionsInt <- SARTfaFilt %>%
  group_by(new_exp_column, new_cond_column) %>%
  summarize(mean_value = mean(CR))

#The misses and CR analyses are appearing as I expected.  The graphs and tables are just the inverse from the analyses of FAs and Hits.  I'm just going to 




```


```{r RQ Is Mind Wandering A Form of Task Switching}
#######################################################################################################
#Analyses of the RQ on Whether or not Mind Wandering and Task Switching share a cognitive mechanism
#######################################################################################################
#Task Switching Analysis
Experiment3TS <- df %>% filter(new_exp_column == "EXP3-TS")
Experiment3TS <- Experiment3TS %>% filter(blockcode == "combinedTask")

#There is an extra data cleaning step to account for here.  I need to eliminate the trials where button mashing occurred.
Experiment3TS <- Experiment3TS %>% filter(latency > 500)

row_count_per_participant <- Experiment3TS %>%
  group_by(subject) %>%
  summarize(row_count = n())
#If I exclude responses occurring 500 ms then two people fall outside the criteria for inclusion in the experiment (507417462 - Not Enjoy, 891302083 - Enjoy).
#If I exclude responses occurring 350 ms or below, there is one person that falls outside the criteria for inclusion (891302083 - Enjoy)
#I'm fine with excluding responses 500 ms and below.

Experiment3TS <- Experiment3TS %>% filter(subject != 507417462)
Experiment3TS <- Experiment3TS %>% filter(subject != 891302083)

#Add in Mind Wandering Variable
TSMindWander <- Experiment3TS[!duplicated(Experiment3TS$subject), ]

# Create a function to process each subject
process_subject <- function(subject_data) {
  # Count the number of "Yes" and "No" responses
  yes_count <- sum(subject_data$probe_response == "Yes")
  no_count <- sum(subject_data$probe_response == "No")
  
  # Compare counts and assign a value based on the majority response
  if (yes_count > no_count) {
    result <- "Yes"
  } else if (yes_count < no_count) {
    result <- "No"
  } else {
    result <- "Tie"  # Handle tie situations if needed
  }
  
  return(result)
}

# Iterate through subjects and process each one
resultsTS <- sapply(split(TSMindWander, TSMindWander$subject), process_subject)

# Display the results
result_dataTS <- data.frame(subject = names(resultsTS), MWer = resultsTS)
print(result_dataTS)
result_dataTS %>% count(MWer)
result_dataTS$subject <- as.integer(result_dataTS$subject)


Experiment3TS <- left_join(Experiment3TS, result_dataTS, by = "subject")

MWTS_groupings <- Experiment3TS[!duplicated(Experiment3TS$subject), ]
MWGroup_counts <- MWTS_groupings %>% 
  group_by(MWer, new_exp_column, new_cond_column) %>% 
  tally(name = "count_of_people")


TSlatency <- lmer(latency~MWer*congruence*switch + (1|subject), data = Experiment3TS)
TSlatencyConfInt <- confint(TSlatency)
TSlatencyLMERresults <- summary(TSlatency)
frequentist_model_table(TSlatencyLMERresults, TSlatencyConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "Latency by Mind Wanderer, Congruenct and Switch Trials")


summary(lmer(latency~congruence*switch + (1|subject), data = Experiment3TS))
summary(lmer(latency~MWer*switch + (1|subject), data = Experiment3TS))
summary(lmer(latency~MWer + (1|subject), data = Experiment3TS))

TSacc <- lmer(correct~MWer*congruence*switch + (1|subject), data = Experiment3TS)
TSaccConfInt <- confint(TSacc)
TSaccLMERresults <- summary(TSacc)
frequentist_model_table(TSaccLMERresults, TSaccConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "Accuracy by Mind Wanderer, Congruenct and Switch Trials")


summary(lmer(correct~congruence*switch + (1|subject), data = Experiment3TS))
summary(lmer(correct~MWer*congruence + (1|subject), data = Experiment3TS))
summary(lmer(correct~MWer + (1|subject), data = Experiment3TS))


PaidbyMWExp3TS <- ggplot(MWTS_groupings, aes(x = MWer, y = paid_response, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
    x = "Mind Wandering Assignment",
    y = "Average Amount to be Paid"
  ) +
  ggtitle(str_wrap("Average Amount of Payment Required to Continue Between Mind Wandering Assignment Conditions", width = 70)) +
  theme_minimal() +
  theme(plot.title = element_text(margin = margin(b = 5)))  # Adjust the bottom margin of the title


# Print the plot
PaidbyMWExp3TS


#SART Processing
Experiment3SART <- df %>% filter(new_exp_column == "EXP3-SART")
Experiment3SART <- Experiment3SART %>% filter(blockcode == "SART")

#Mind Wandering Assignment
#Add in Mind Wandering Variable
SARTMindWander <- Experiment3SART[!duplicated(Experiment3SART$subject), ]

# Create a function to process each subject
process_subject <- function(subject_data) {
  # Count the number of "Yes" and "No" responses
  yes_count <- sum(subject_data$probe_response == "Yes")
  no_count <- sum(subject_data$probe_response == "No")
  
  # Compare counts and assign a value based on the majority response
  if (yes_count > no_count) {
    result <- "Yes"
  } else if (yes_count < no_count) {
    result <- "No"
  } else {
    result <- "Tie"  # Handle tie situations if needed
  }
  
  return(result)
}

# Iterate through subjects and process each one
resultsSART <- sapply(split(SARTMindWander, SARTMindWander$subject), process_subject)

# Display the results
result_dataSART <- data.frame(subject = names(resultsSART), MWer = resultsSART)
print(result_dataSART)
result_dataSART %>% count(MWer)
result_dataSART$subject <- as.integer(result_dataSART$subject)



###SART analysis for Exp3
Experiment3SART <- left_join(Experiment3SART, result_dataSART, by = "subject")

####Analysis of SART Performance
Experiment3SART$hit <- ifelse(Experiment3SART$trialtype == "NoGo" & Experiment3SART$correct == 1, 1, 0)
Experiment3SART$miss <- ifelse(Experiment3SART$trialtype == "NoGo" & Experiment3SART$correct == 0, 1, 0)
Experiment3SART$CR <- ifelse(Experiment3SART$trialtype == "Go" & Experiment3SART$correct == 1, 1, 0)
Experiment3SART$FA <- ifelse(Experiment3SART$trialtype == "Go" & Experiment3SART$correct == 0, 1, 0)


Exp3SARTrtFilt <- Experiment3SART %>% filter(correct == 1)
Exp3SARTrtFilt <- Experiment3SART %>% filter(trialtype == "Go")
Exp3SARTfaFilt <- Experiment3SART %>% filter(trialtype == "Go")

Exp3SARTaccFilt <- Experiment3SART %>% filter(trialtype == "NoGo")
Exp3SARTmissFilt <- Experiment3SART %>% filter(trialtype == "NoGo")


Exp3FAmean <- aggregate(FA ~ subject + new_exp_column + new_cond_column, Exp3SARTfaFilt, mean)
Exp3Hitmean <- aggregate(correct ~ subject + new_exp_column + new_cond_column, Exp3SARTaccFilt, mean)
Exp3Missmean <- aggregate(CR ~ subject + new_exp_column + new_cond_column, Exp3SARTrtFilt, mean)
Exp3RTmean <- aggregate(latency ~ subject + new_exp_column + new_cond_column, Exp3SARTrtFilt, mean)

Exp3QualCheck <- left_join(Exp3Hitmean, Exp3FAmean, by = "subject") %>%
  left_join(Exp3Missmean, by = "subject") %>%
  left_join(Exp3RTmean, by = "subject")
# 538020870 did not respond to 50% of the task.  However, it isn't as if they walked away, they just randomly did not respond, and when they did respond,it was distributed between the no-go and go trials.  

###Analysis of RT for SART
# Exp3RTlm <- lm(latency~new_cond_column*MWer, data = Exp3SARTrtFilt)
# summary(Exp3RTlm)

Exp3RTlm <- lmer(latency~new_cond_column * MWer + (1 | subject), data=Exp3SARTrtFilt)
summary(Exp3RTlm)

Exp3RTConfInt <- confint(Exp3RTlm)
Exp3RTLMERresults <- summary(Exp3RTlm)
frequentist_model_table(Exp3RTLMERresults, Exp3RTConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "SART Latency by Mind Wanderer, Congruenct and Switch Trials")


Exp3RTbyGroup <- ggplot(Exp3SARTrtFilt, aes(x = new_cond_column, y = latency, fill = MWer)) +
    stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 2)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average Reaction Time",
    title = "Average Reaction Time Between Enjoyment Conditions and MW Assignment"
  ) +
  theme_minimal()
Exp3RTbyGroup


Exp3RTbyConditionsInt <- Exp3SARTrtFilt %>%
  group_by(new_cond_column, MWer) %>%
  summarize(mean_value = mean(latency))
print(Exp3RTbyConditionsInt)

#####Analysis of ACC for SART NoGo Trials
# Exp3ACClm <- lm(correct ~ new_cond_column*MWer, data = Exp3SARTaccFilt)
# summary(Exp3ACClm)

Exp3ACClm <- lmer(correct~new_cond_column * MWer + (1 | subject), data=Exp3SARTaccFilt)
summary(Exp3ACClm)

Exp3ACCConfInt <- confint(Exp3ACClm)
Exp3ACCLMERresults <- summary(Exp3ACClm)
frequentist_model_table(Exp3ACCLMERresults, Exp3ACCConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "SART Accuracy by Mind Wanderer, Congruenct and Switch Trials")


Exp3ACCbyGroup <- ggplot(Exp3SARTaccFilt, aes(x = new_cond_column, y = correct, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 2)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average Reaction Time",
    title = "Average Accuracy of No Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
Exp3ACCbyGroup

Exp3ACCbyConditionsInt <- Exp3SARTaccFilt %>%
  group_by(new_cond_column, MWer) %>%
  summarize(mean_value = mean(correct))
print(Exp3ACCbyConditionsInt)

Exp3SARTfaFilt <- Exp3SARTrtFilt
Exp3SARTmissFILT <- Exp3SARTaccFilt

#Remember*** I am interpreting the target (No Go trials) as hits.  So withholding a response on a Go trial would be an FA
# Exp3FAlm <- lm(FA ~ new_cond_column*MWer, data = Exp3SARTfaFilt)
# summary(Exp3FAlm)

Exp3FAlm <- lmer(FA~new_cond_column * MWer + (1 | subject), data=Exp3SARTfaFilt)
summary(Exp3FAlm)

Exp3FAConfInt <- confint(Exp3FAlm)
Exp3FALMERresults <- summary(Exp3FAlm)
frequentist_model_table(Exp3FALMERresults, Exp3FAConfInt,
 # Replace colons in the names of interactions with times symbols
  interaction_symbol_x = TRUE, 
  
  #Rename Title, for No title replace text with NULL
  caption = "SART Accuracy by Mind Wanderer, Congruenct and Switch Trials")


Exp3FAbyGroup <- ggplot(Exp3SARTfaFilt, aes(x = new_cond_column, y = FA, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average False Alarms",
    title = "Average False Alarms of Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
Exp3FAbyGroup

Exp3FAbyConditionsInt <- Exp3SARTfaFilt %>%
  group_by(new_cond_column, MWer) %>%
  summarize(mean_value = mean(FA))
print(Exp3FAbyConditionsInt)

Exp3MISSbyGroup <- ggplot(Exp3SARTmissFILT, aes(x = new_cond_column, y = miss, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average False Alarms",
    title = "Average False Alarms of Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
Exp3MISSbyGroup

Exp3MissbyConditionsInt <- Exp3SARTmissFILT %>%
  group_by(new_cond_column, MWer) %>%
  summarize(mean_value = mean(miss))


Exp3CRbyGroup <- ggplot(Exp3SARTfaFilt, aes(x = new_cond_column, y = CR, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Enjoyment Condition",
    y = "Average False Alarms",
    title = "Average False Alarms of Go Trials Between Enjoyment and Probe Conditions"
  ) +
  theme_minimal()
Exp3CRbyGroup

Exp3CRbyConditionsInt <- Exp3SARTfaFilt %>%
  group_by(new_cond_column, MWer) %>%
  summarize(mean_value = mean(CR))

#The misses and CR analyses are appearing as I expected.  The graphs and tables are just the inverse from the analyses of FAs and Hits.  I'm just going to 





```

```{r Analysis of corrected EFA}
# ##################################################################################################################
# #These are my analyses for Post Task Surveys
# ##################################################################################################################

library(corrr)
library(ggcorrplot)
library(FactoMineR)
library(psych)
library(GPArotation)

##########MW Response Analysis#######################

SurveyAnalysis <- df

MWerResultsData <- rbind(MWresult_dataExp1Exp2, result_dataSART, result_dataTS)

SurveyAnalysis <- left_join(SurveyAnalysis, MWerResultsData, by = "subject")
SurveyAnalysis <- SurveyAnalysis %>% filter(!is.na(MWer))
length(unique(SurveyAnalysis$subject))

#NASA-TLX Transformations
SurveyAnalysis <- SurveyAnalysis %>%
  mutate(mentaldemand_response_coded = (mentaldemand_response - 1) * 5)


SurveyAnalysis <- SurveyAnalysis %>%
  mutate(physicaldemand_response_coded = (physicaldemand_response - 1) * 5)


SurveyAnalysis <- SurveyAnalysis %>%
  mutate(temporaldemand_response_coded = (temporaldemand_response - 1) * 5)


SurveyAnalysis <- SurveyAnalysis %>%
  mutate(performance_response_coded = (performance_response - 1) * 5)


SurveyAnalysis <- SurveyAnalysis %>%
  mutate(effort_response_coded = (effort_response - 1) * 5)

SurveyAnalysis <- SurveyAnalysis %>%
  mutate(frustration_response_coded = (frustration_response - 1) * 5)


PostSurveys <- SurveyAnalysis[!duplicated(SurveyAnalysis$subject), ]

PostSurveys$difficulty_responseNum <- ifelse(PostSurveys$difficulty_response == 'Very Difficult', 1, ifelse(PostSurveys$difficulty_response == 'Difficult', 2, ifelse(PostSurveys$difficulty_response == 'Neither Easy/Difficult', 3, ifelse(PostSurveys$difficulty_response == 'Easy', 4, ifelse(PostSurveys$difficulty_response == 'Very Easy', 5, 999)))))


PostSurveys$interest_responseNum <- ifelse(PostSurveys$interest_response == 'Not at all interesting', 1, ifelse(PostSurveys$interest_response == 'A little interesting', 2, ifelse(PostSurveys$interest_response == 'Somewhat interesting', 3, ifelse(PostSurveys$interest_response == 'Pretty interesting', 4, ifelse(PostSurveys$interest_response == 'Highly Interesting', 5, 999)))))

PostSurveys <- PostSurveys %>% filter(MWer != "Tie")


ggplot(PostSurveys, aes(x = paid_response, fill = new_exp_column)) +
  geom_density(alpha=0.2)

ggplot(PostSurveys, aes(x = paid_response, fill = MWer)) +
  geom_density(alpha=0.2)

MWprobePlace <- ggplot(data = PostSurveys, aes(x = new_exp_column, y = paid_response, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") + 
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red"))
MWprobePlace


MWprobePlace.labs <- MWprobePlace + labs(title = "Average Amount to be Paid by Experiment", x = "Experimental Condition", y = "Average Amount to be Paid") + scale_x_discrete(limit = c("EXP1", "EXP2", "EXP3-TS", "EXP3-SART"), labels = c("Interrupting Probe","Retrospective Probe", "Task Switching Paradigm", "SART"))
MWprobePlace.labs


colnames(PostSurveys)

pcadf <- PostSurveys[, c(82, 102, 103, 104, 105, 106, 107, 108, 109)]

model = fa(pcadf, 5, rotate="varimax")
model
model$loadings
model$scores
model$r.scores
modelResults <- model$scores
model$scor
model$uniquenesses

plot(1:length(model$e.values), model$e.values, type = "b", 
     xlab = "Factor Number", ylab = "Eigenvalue",
     main = "Scree Plot")

EFAanalysis <- cbind(PostSurveys, modelResults)
summary(lm(MR1 ~ new_exp_column*new_cond_column*MWer, data= EFAanalysis))
summary(lm(MR1 ~ new_exp_column*MWer, data= EFAanalysis))
summary(lm(MR1 ~ new_cond_column*MWer, data= EFAanalysis))
summary(lm(MR1 ~ new_exp_column, data= EFAanalysis))
summary(lm(MR1 ~ new_cond_column, data= EFAanalysis))
summary(lm(MR1 ~ MWer, data= EFAanalysis))
summary(lm(MR2 ~ new_exp_column*new_cond_column*MWer, data= EFAanalysis))
summary(lm(MR3 ~ new_exp_column*new_cond_column*MWer, data= EFAanalysis))
summary(lm(MR4 ~ new_exp_column*new_cond_column*MWer, data= EFAanalysis))
summary(lm(MR5 ~ new_exp_column*new_cond_column*MWer, data= EFAanalysis))

ggplot(EFAanalysis, aes(x = MR1, color = MWer)) +
   geom_density()

ggplot(EFAanalysis, aes(x = MR2, color = MWer)) +
   geom_density()


table(EFAanalysis$difficulty_responseNum)
table(EFAanalysis$interest_responseNum)
table(EFAanalysis$effort_response_coded)
table(EFAanalysis$physicaldemand_response_coded)
table(EFAanalysis$temporaldemand_response_coded)
table(EFAanalysis$performance_response_coded)
table(EFAanalysis$frustration_response_coded)
table(EFAanalysis$GTQ_response)
table(EFAanalysis$MWer)

#Tables for the raw EFA scores based on MW assignment and MW assignment by Enjoyable condition
MWerAndEnjoyableConditionByFactorLoadings <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_MR1 = mean(MR1))

MWerAndEnjoyableConditionByFactorLoadings

MWerAndEnjoyableConditionByFactorLoadings2 <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_MR1 = mean(MR5))

MWerAndEnjoyableConditionByFactorLoadings2


#Tables for the raw Mental Demand Coded Scores by MW assignment and Enjoyment Condition
MWerByMentalDemand  <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_MentalDemand = mean(mentaldemand_response_coded))


ggplot(EFAanalysis, aes(x = mentaldemand_response_coded)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Mental Demand", x = "Value", y = "Frequency") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = mentaldemand_response_coded, color = MWer)) +
  geom_density()

mentalwide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(mentaldemand_response_coded),
            sd_value = sd(mentaldemand_response_coded)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

mentallong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(mentaldemand_response_coded),
    sd_value = sd(mentaldemand_response_coded, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(mentallong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Mental Demand Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))

#Tables for the raw Physical Demand Coded Scores by MW assignment and Enjoyment Condition
MWerByPhysicalDemand <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_PhysicalDemand = mean(physicaldemand_response_coded))

ggplot(EFAanalysis, aes(x = physicaldemand_response_coded)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Physical Demand", x = "Value", y = "Frequency") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = physicaldemand_response_coded, color = MWer)) +
  geom_density()

physicalwide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(physicaldemand_response_coded),
            sd_value = sd(physicaldemand_response_coded)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

physicallong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(physicaldemand_response_coded),
    sd_value = sd(physicaldemand_response_coded, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(physicallong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Physical Demand Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))

#Tables for the raw Temporal Demand Coded Scores by MW assignment and Enjoyment Condition
MWerBytemporaldemand <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_TemporalDemand = mean(temporaldemand_response_coded))

ggplot(EFAanalysis, aes(x = temporaldemand_response_coded)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Temporal Demand", x = "Value", y = "Frequency") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = temporaldemand_response_coded, color = MWer)) +
  geom_density()

temporalwide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(temporaldemand_response_coded),
            sd_value = sd(temporaldemand_response_coded)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

temporallong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(temporaldemand_response_coded),
    sd_value = sd(temporaldemand_response_coded, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(temporallong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Temporal Demand Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))

#Tables for the raw Performance Coded Scores by MW assignment and Enjoyment Condition
MWerByperformance <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_Performance = mean(performance_response_coded))

ggplot(EFAanalysis, aes(x = performance_response_coded)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Performance Response", x = "Value", y = "Frequency") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = performance_response_coded, color = MWer)) +
  geom_density()

performancewide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(performance_response_coded),
            sd_value = sd(performance_response_coded)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

performancelong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(performance_response_coded),
    sd_value = sd(performance_response_coded, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(performancelong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Performance Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))

#Tables for the raw Effort Coded Scores by MW assignment and Enjoyment Condition
MWerByeffort <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_Effort = mean(effort_response_coded))

ggplot(EFAanalysis, aes(x = new_exp_column, y = effort_response_coded, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  labs(title = "Histogram of Effort Response", x = "Value", y = "Experiment") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = effort_response_coded, color = MWer)) +
  geom_density()

effortwide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(effort_response_coded),
            sd_value = sd(effort_response_coded)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

effortlong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(effort_response_coded),
    sd_value = sd(effort_response_coded, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(effortlong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Effort Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))

#Tables for the raw Frustration Coded Scores by MW assignment and Enjoyment Condition
MWerByfrustration <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_Frustration = mean(frustration_response_coded))

ggplot(EFAanalysis, aes(x = frustration_response_coded)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Frustration Response", x = "Value", y = "Frequency") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = frustration_response_coded, color = MWer)) +
  geom_density()

frustrationwide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(frustration_response_coded),
            sd_value = sd(frustration_response_coded)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

frustrationlong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(frustration_response_coded),
    sd_value = sd(frustration_response_coded, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(frustrationlong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Frustration Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))

#Tables for the raw Difficulty Response Scores by MW assignment and Enjoyment Condition
MWerBydifficulty <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_Difficulty = mean(difficulty_responseNum))

ggplot(EFAanalysis, aes(x = difficulty_responseNum)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Difficulty Response", x = "Value", y = "Frequency") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = difficulty_responseNum, color = MWer)) +
  geom_density()

difficultywide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(difficulty_responseNum),
            sd_value = sd(difficulty_responseNum)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

difficultylong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(difficulty_responseNum),
    sd_value = sd(difficulty_responseNum, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(difficultylong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Difficulty Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))


#Tables for the raw Interest Response Scores by MW assignment and Enjoyment Condition
MWerByinterest <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_Interest = mean(interest_responseNum))

ggplot(EFAanalysis, aes(x = interest_responseNum, color = MWer)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Interest Response", x = "Value", y = "Frequency") +
  theme_minimal()

ggplot(EFAanalysis, aes(x = interest_responseNum, color = MWer)) +
  geom_density()

Interestwide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(interest_responseNum),
            sd_value = sd(interest_responseNum)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

Interestlong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(interest_responseNum),
    sd_value = sd(interest_responseNum, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(Interestlong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Interest Response Scores", x = "Experimental Condition", y = "Average Response Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))



#GTQ Analysis
MWerByGTQ <- EFAanalysis %>%
  group_by(MWer, new_exp_column, new_cond_column) %>%
  summarise(
    avg_GTQ = mean(GTQ_response))

ggplot(EFAanalysis, aes(x = GTQ_response, color = MWer)) +
  geom_density()

ggplot(EFAanalysis, aes(x = GTQ_response)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of GTQ", x = "Value", y = "Frequency") +
  theme_minimal()

GTQwide_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(GTQ_response),
            sd_value = sd(GTQ_response)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

GTQlong_data <- EFAanalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(GTQ_response),
    sd_value = sd(GTQ_response, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(GTQlong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "GTQ Response Scores", x = "Experimental Condition", y = "Mean GTQ Response", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))
  
summary(lm(GTQ_response ~ MWer*new_exp_column, data = EFAanalysis))


ggplot(EFAanalysis, aes(x = MR1, color = MWer)) +
  geom_density()

Misery <- ggplot(EFAanalysis, aes(x = new_exp_column, y = MR1, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Task Type",
    y = "Average Factor1 Ratings",
    title = "Average Factor1 Ratings Between Task and Mind Wanderers"
  ) +
  theme_minimal()
Misery

Misery2 <- ggplot(EFAanalysis, aes(x = MWer, y = MR1, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Task Type",
    y = "Average Factor1 Ratings",
    title = "Average Factor1 Ratings Between Task and Mind Wanderers"
  ) +
  theme_minimal()
Misery2

Engaged <- ggplot(EFAanalysis, aes(x = new_exp_column, y = MR5, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Task Type",
    y = "Average Factor5 Ratings",
    title = "Average Factor5 Ratings Between Task and Mind Wanderers"
  ) +
  theme_minimal()
Engaged

Engaged2 <- ggplot(EFAanalysis, aes(x = MWer, y = MR5, fill = MWer)) +
  stat_summary(
    fun = "mean", 
    geom = "bar", 
    position = position_dodge(width = 0.9),
    aes(label = round(..y.., digits = 2)),
    vjust = -0.5
  ) +
  geom_text(
    stat = "summary", 
    fun = "mean", 
    aes(label = round(..y.., digits = 3)),
    position = position_dodge(width = 0.9),
    vjust = -0.5
  ) +
  labs(
   x = "Task Type",
    y = "Average Factor5 Ratings",
    title = "Average Factor5 Ratings Between Task and Mind Wanderers"
  ) +
  theme_minimal()
Engaged2




```



```{r Post Task Analyses for Exp1 and Exp3}
EXP1PostAnalysis <- EFAanalysis %>% filter(new_exp_column != "EXP3-SART")
EXP1PostAnalysis <- EXP1PostAnalysis %>% filter(new_exp_column != "EXP3-TS")

summary(lm(MR1 ~ MWer*new_exp_column, data = EXP1PostAnalysis))
summary(lm(MR5 ~ MWer*new_exp_column, data = EXP1PostAnalysis))

PaidMWlmProbeEXP1 <- lm(paid_response~new_exp_column*new_cond_column, data = EXP1PostAnalysis)
summary(PaidMWlmProbeEXP1)

PaidMWlmProbeEXP1_2 <- lm(paid_response~new_exp_column*MWer, data = EXP1PostAnalysis)
summary(PaidMWlmProbeEXP1_2)

PaidLmresult <- EXP1PostAnalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarize(mean_value = mean(paid_response))

# Print the result
print(PaidLmresult)

#Do our factors from the EFA, along with mind wandering, affect willingness to reengage?
summary(lm(paid_response ~ new_exp_column*MWer*MR1*MR5, data = EXP1PostAnalysis))


EXP3PostAnalysis <- EFAanalysis %>% filter(new_exp_column != "EXP1")
EXP3PostAnalysis <- EXP3PostAnalysis %>% filter(new_exp_column != "EXP2")

PaidMWlmProbeEXP3 <- lm(paid_response~MWer*new_exp_column, data = EXP3PostAnalysis)
summary(PaidMWlmProbeEXP3)

PaidLmresultExp3 <- EXP3PostAnalysis %>%
  group_by(new_exp_column, MWer) %>%
  summarize(mean_value = mean(paid_response))

# Print the result
print(PaidLmresult)


summary(lm(MR1 ~ MWer*new_exp_column, data = EXP3PostAnalysis))
summary(lm(MR5 ~ MWer*new_exp_column, data = EXP3PostAnalysis))
summary(lm(paid_response ~ new_exp_column*MWer*MR1*MR5, data = EXP3PostAnalysis))


summary(lm(paid_response ~ new_exp_column*MWer*MR1*MR5, data = EFAanalysis))

ggplot(EFAanalysis, aes(x = as.factor(MWer), y = paid_response, group = new_exp_column, color = new_exp_column)) +
  stat_summary(fun = "mean", geom = "line", aes(group = new_exp_column)) +
  stat_summary(fun = "mean", geom = "point", aes(group = new_exp_column)) +
  labs(x = "Mind Wander", y = "Paid Response", color = "Experiment")

ggplot(EFAanalysis, aes(x = as.factor(new_exp_column), y = paid_response, group = new_exp_column, color = MWer)) +
  stat_summary(fun = "mean", geom = "line", aes(group = MWer)) +
  stat_summary(fun = "mean", geom = "point", aes(group = MWer)) +
  labs(x = "Experiment", y = "Paid Response", color = "Mind Wander")

#=================================================================================================
#Catch Trials - I don't think we can do a proper analysis of the Catch Trials
#=================================================================================================
EXP1CatchAnalysis <- EXP1PostAnalysis %>% dplyr::select(c("subject", "MWer", "new_exp_column", "new_cond_column"))
EXP1CatchAnalysis <-EXP1CatchAnalysis %>% filter(new_exp_column == "EXP1")
EXP1CatchAnalysis <- EXP1CatchAnalysis %>% left_join(EXP1MWcatchTrialsAverages, by = "subject")

EXP2CatchAnalysis <- EXP1PostAnalysis %>% dplyr::select(c("subject", "MWer", "new_exp_column", "new_cond_column", "MWcatch_response", "MWonTask_response", "MWother_response"))
EXP2CatchAnalysis <- EXP2CatchAnalysis %>% filter(new_exp_column == "EXP2")

EXP3CatchAnalysis <- EXP3PostAnalysis %>% dplyr::select(c("subject", "MWer", "new_exp_column", "new_cond_column", "MWcatch_response", "MWonTask_response", "MWother_response"))
EXP3CatchAnalysis <- EXP3CatchAnalysis %>% filter(new_exp_column != "EXP1")
EXP3CatchAnalysis <- EXP3CatchAnalysis %>% filter(new_exp_column != "EXP2")

AllParticipantCatchTrials <- rbind(EXP1CatchAnalysis, EXP2CatchAnalysis, EXP3CatchAnalysis)

#These are the people who are missing Catch Trial Responses
NoResponsesForCatchTrials <- aggregate(. ~ new_exp_column + new_cond_column, data = AllParticipantCatchTrials[, c("new_exp_column", "new_cond_column", "MWcatch_response", "MWonTask_response", "MWother_response")], FUN = function(x) sum(is.na(x)), na.action = na.pass)

TotalParticipantForEachCond <- AllParticipantCatchTrials %>% group_by(new_exp_column) %>% count(new_cond_column)

NoResponsesForCatchTrials <- NoResponsesForCatchTrials %>% left_join(TotalParticipantForEachCond, by = c("new_exp_column", "new_cond_column"))


AllParticipantCatchTrialsNAremoved <- AllParticipantCatchTrials[complete.cases(AllParticipantCatchTrials), ]

MWCatchTrials_data <- AllParticipantCatchTrialsNAremoved %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(MWcatch_response),
            sd_value = sd(MWcatch_response)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

MWCatchTrialslong_data <- AllParticipantCatchTrialsNAremoved %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(MWcatch_response),
    sd_value = sd(MWcatch_response, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(MWCatchTrialslong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Catch Trials Response Scores", x = "Experimental Condition", y = "Average MW Catch TrialsResponse Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))


OnTaskCatchTrials_data <- AllParticipantCatchTrialsNAremoved %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(MWonTask_response),
            sd_value = sd(MWonTask_response)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

OnTaskCatchTrialslong_data <- AllParticipantCatchTrialsNAremoved %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(MWonTask_response),
    sd_value = sd(MWonTask_response, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(OnTaskCatchTrialslong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Catch Trials Response Scores", x = "Experimental Condition", y = "Average On Task Catch TrialsResponse Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))


OtherCatchTrials_data <- AllParticipantCatchTrialsNAremoved %>%
  group_by(new_exp_column, MWer) %>%
  summarise(mean_value = mean(MWother_response),
            sd_value = sd(MWother_response)) %>%
  pivot_wider(names_from = MWer, values_from = c(mean_value, sd_value),
              names_glue = "{.value}_{MWer}")

OtherCatchTrialslong_data <- AllParticipantCatchTrialsNAremoved %>%
  group_by(new_exp_column, MWer) %>%
  summarise(
    N = length(MWer),
    mean_value = mean(MWother_response),
    sd_value = sd(MWother_response, na.rm = TRUE),
    se_value = sd_value/sqrt(N),
    ciMult = qt(0.95/2 + .5, N-1),
    ci = se_value*ciMult
  )

ggplot(OtherCatchTrialslong_data, aes(x = new_exp_column, y = mean_value, fill = MWer)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  scale_fill_manual(values = c("Yes" = "blue", "No" = "red")) +
  geom_errorbar(aes(ymin = mean_value - ci, ymax = mean_value + ci),
                position = position_dodge(1), width = 0.2) +
  labs(title = "Catch Trials Response Scores", x = "Experimental Condition", y = "Average Other Catch TrialsResponse Ratings", fill = "Mind Wanderer") +
  scale_x_discrete(labels = c("EXP1" = "Interrupting Probe",
                              "EXP2" = "Post Probe",
                              "EXP3-SART" = "SART",
                              "EXP3-TS" = "Letter/Number Task Switch"))


summary(lm(MWcatch_response ~ MWer*new_exp_column, data = AllParticipantCatchTrialsNAremoved))
summary(lm(MWonTask_response ~ MWer*new_exp_column, data = AllParticipantCatchTrialsNAremoved))
summary(lm(MWother_response ~ MWer*new_exp_column, data = AllParticipantCatchTrialsNAremoved))




```

